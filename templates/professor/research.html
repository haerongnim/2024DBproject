{% extends 'base.html' %}

{% block content %}
<style>
    .research-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
    }
    .research-button {
        width: 100%;
        padding: 15px;
        margin: 20px 0;
        font-size: 1.2em;
        background-color: #4e0061;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    .research-button:hover {
        background-color: #3d004d;
        transform: translateY(-2px);
    }
    .magic-form {
        display: none;
        margin-top: 20px;
        padding: 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .form-group {
        margin-bottom: 15px;
    }
    .form-group label {
        display: block;
        margin-bottom: 5px;
        color: #333;
    }
    .form-group input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
</style>

<div class="research-container">
    <h2> 마법 연구실</h2>
    <button id="researchButton" class="research-button">마법 연구 시작</button>
    
    <form id="magicForm" class="magic-form">
        <div class="form-group">
            <label for="magicName">마법 이름 (필요한 글자 수: <span id="nameLength">0</span>)</label>
            <input type="text" id="magicName" required>
        </div>
        <div class="form-group">
            <label for="capacity">수강 정원</label>
            <input type="number" id="capacity" value="30" min="1" max="100" required>
        </div>
        <button type="submit" class="research-button">마법 생성</button>
    </form>
</div>

<script>
    let requiredLength;
    const researchButton = document.getElementById('researchButton');
    const magicForm = document.getElementById('magicForm');

    researchButton.addEventListener('click', function() {
        fetch('/professor/research/attempt', {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                requiredLength = data.name_length;
                document.getElementById('nameLength').textContent = requiredLength;
                magicForm.style.display = 'block';
            }
            alert(data.message);
        });
    });

    magicForm.addEventListener('submit', function(event) {
        event.preventDefault();
        
        const name = document.getElementById('magicName').value;
        if (name.length !== requiredLength) {
            alert(`마법 이름은 ${requiredLength}글자여야 합니다.`);
            return;
        }
        
        const capacity = document.getElementById('capacity').value;
        
        fetch('/professor/create_magic', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: `magic_name=${encodeURIComponent(name)}&capacity=${capacity}`
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
            if (data.success) {
                magicForm.style.display = 'none';
                magicForm.reset();
                requiredLength = null;
            }
        });
    });
</script>
{% endblock %}
