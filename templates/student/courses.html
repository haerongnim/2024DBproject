<!DOCTYPE html>
<html>
<head>
    <title>마법 강의 목록</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .sort-controls { margin-bottom: 20px; }
        .card { 
            border: 1px solid #ddd; 
            border-radius: 5px; 
            margin-bottom: 15px;
            padding: 15px;
        }
        .card-title { margin-top: 0; }
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .btn-primary { background-color: #4CAF50; color: white; }
        .btn-secondary { background-color: #9e9e9e; color: white; }
        .btn-success { background-color: #2196F3; color: white; }
        .form-control {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        .mb-2 { margin-bottom: 10px; }
        .mb-3 { margin-bottom: 15px; }
    </style>
</head>
<body>
    <h2>마법 강의 목록</h2>

    <div class="sort-controls mb-3">
        <label>정렬 기준:</label>
        <select id="sortSelect" onchange="updateSort(this.value)">
            <option value="magic_name_asc" {% if sort_by == 'magic_name_asc' %}selected{% endif %}>마법 이름 (오름차순)</option>
            <option value="magic_name_desc" {% if sort_by == 'magic_name_desc' %}selected{% endif %}>마법 이름 (내림차순)</option>
            <option value="professor_asc" {% if sort_by == 'professor_asc' %}selected{% endif %}>교수 이름 (오름차순)</option>
            <option value="professor_desc" {% if sort_by == 'professor_desc' %}selected{% endif %}>교수 이름 (내림차순)</option>
            <option value="capacity_asc" {% if sort_by == 'capacity_asc' %}selected{% endif %}>수강 정원 (오름차순)</option>
            <option value="capacity_desc" {% if sort_by == 'capacity_desc' %}selected{% endif %}>수강 정원 (내림차순)</option>
        </select>
    </div>

    <div class="courses-list">
        {% for course in courses %}
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">{{ course[1] }}</h5>
                <p class="card-text">
                    교수: {{ course[2] }}<br>
                    수강 인원: {{ course[4] }}/{{ course[3] }}<br>
                    상태: {{ '수강신청 가능' if course[5] else '수강신청 마감' }}
                </p>
                {% if not course[6] %}
                    {% if course[5] %}
                    <button class="btn btn-primary" onclick="enrollCourse({{ course[0] }})">수강신청</button>
                    {% else %}
                    <button class="btn btn-secondary" disabled>수강신청 마감</button>
                    {% endif %}
                {% else %}
                <div class="n-sentence-form">
                    <textarea class="form-control mb-2" id="nsentence-{{ course[0] }}" placeholder="N행시를 작성해주세요"></textarea>
                    <button class="btn btn-success" onclick="submitNSentence({{ course[0] }})">N행시 제출</button>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <script>
        function updateSort(value) {
            window.location.href = `/student/courses?sort=${value}`;
        }

        function enrollCourse(magicId) {
            fetch(`/student/enroll/${magicId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                if (data.success) {
                    location.reload();
                }
            });
        }

        function submitNSentence(magicId) {
            const content = document.getElementById(`nsentence-${magicId}`).value;
            fetch(`/student/submit_nsentence/${magicId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `content=${encodeURIComponent(content)}`
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            });
        }
    </script>
</body>
</html>
